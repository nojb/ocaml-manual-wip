<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Stdlib.Format.html">
<link rel="next" href="Stdlib.Gc.html">
<link rel="Up" href="Stdlib.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Format_tutorial" rel="Chapter" href="Format_tutorial.html">
<link title="Ocaml_operators" rel="Chapter" href="Ocaml_operators.html">
<link title="Arg" rel="Chapter" href="Arg.html">
<link title="Array" rel="Chapter" href="Array.html">
<link title="ArrayLabels" rel="Chapter" href="ArrayLabels.html">
<link title="Atomic" rel="Chapter" href="Atomic.html">
<link title="Bigarray" rel="Chapter" href="Bigarray.html">
<link title="Bool" rel="Chapter" href="Bool.html">
<link title="Buffer" rel="Chapter" href="Buffer.html">
<link title="Bytes" rel="Chapter" href="Bytes.html">
<link title="BytesLabels" rel="Chapter" href="BytesLabels.html">
<link title="Callback" rel="Chapter" href="Callback.html">
<link title="Char" rel="Chapter" href="Char.html">
<link title="Complex" rel="Chapter" href="Complex.html">
<link title="Condition" rel="Chapter" href="Condition.html">
<link title="Digest" rel="Chapter" href="Digest.html">
<link title="Domain" rel="Chapter" href="Domain.html">
<link title="Dynarray" rel="Chapter" href="Dynarray.html">
<link title="Dynlink" rel="Chapter" href="Dynlink.html">
<link title="Effect" rel="Chapter" href="Effect.html">
<link title="Either" rel="Chapter" href="Either.html">
<link title="Ephemeron" rel="Chapter" href="Ephemeron.html">
<link title="Event" rel="Chapter" href="Event.html">
<link title="Filename" rel="Chapter" href="Filename.html">
<link title="Float" rel="Chapter" href="Float.html">
<link title="Format" rel="Chapter" href="Format.html">
<link title="Fun" rel="Chapter" href="Fun.html">
<link title="Gc" rel="Chapter" href="Gc.html">
<link title="Hashtbl" rel="Chapter" href="Hashtbl.html">
<link title="Iarray" rel="Chapter" href="Iarray.html">
<link title="In_channel" rel="Chapter" href="In_channel.html">
<link title="Int" rel="Chapter" href="Int.html">
<link title="Int32" rel="Chapter" href="Int32.html">
<link title="Int64" rel="Chapter" href="Int64.html">
<link title="Lazy" rel="Chapter" href="Lazy.html">
<link title="Lexing" rel="Chapter" href="Lexing.html">
<link title="List" rel="Chapter" href="List.html">
<link title="ListLabels" rel="Chapter" href="ListLabels.html">
<link title="Map" rel="Chapter" href="Map.html">
<link title="Marshal" rel="Chapter" href="Marshal.html">
<link title="MoreLabels" rel="Chapter" href="MoreLabels.html">
<link title="Mutex" rel="Chapter" href="Mutex.html">
<link title="Nativeint" rel="Chapter" href="Nativeint.html">
<link title="Obj" rel="Chapter" href="Obj.html">
<link title="Oo" rel="Chapter" href="Oo.html">
<link title="Option" rel="Chapter" href="Option.html">
<link title="Out_channel" rel="Chapter" href="Out_channel.html">
<link title="Pair" rel="Chapter" href="Pair.html">
<link title="Parsing" rel="Chapter" href="Parsing.html">
<link title="Pqueue" rel="Chapter" href="Pqueue.html">
<link title="Printexc" rel="Chapter" href="Printexc.html">
<link title="Printf" rel="Chapter" href="Printf.html">
<link title="Queue" rel="Chapter" href="Queue.html">
<link title="Random" rel="Chapter" href="Random.html">
<link title="Repr" rel="Chapter" href="Repr.html">
<link title="Result" rel="Chapter" href="Result.html">
<link title="Runtime_events" rel="Chapter" href="Runtime_events.html">
<link title="Scanf" rel="Chapter" href="Scanf.html">
<link title="Semaphore" rel="Chapter" href="Semaphore.html">
<link title="Seq" rel="Chapter" href="Seq.html">
<link title="Set" rel="Chapter" href="Set.html">
<link title="Stack" rel="Chapter" href="Stack.html">
<link title="StdLabels" rel="Chapter" href="StdLabels.html">
<link title="Stdlib" rel="Chapter" href="Stdlib.html">
<link title="Str" rel="Chapter" href="Str.html">
<link title="String" rel="Chapter" href="String.html">
<link title="StringLabels" rel="Chapter" href="StringLabels.html">
<link title="Sys" rel="Chapter" href="Sys.html">
<link title="Thread" rel="Chapter" href="Thread.html">
<link title="Type" rel="Chapter" href="Type.html">
<link title="Uchar" rel="Chapter" href="Uchar.html">
<link title="Unit" rel="Chapter" href="Unit.html">
<link title="Unix" rel="Chapter" href="Unix.html">
<link title="UnixLabels" rel="Chapter" href="UnixLabels.html">
<link title="Weak" rel="Chapter" href="Weak.html">
<link title="CamlinternalFormat" rel="Chapter" href="CamlinternalFormat.html">
<link title="CamlinternalFormatBasics" rel="Chapter" href="CamlinternalFormatBasics.html">
<link title="CamlinternalLazy" rel="Chapter" href="CamlinternalLazy.html">
<link title="CamlinternalMod" rel="Chapter" href="CamlinternalMod.html">
<link title="CamlinternalOO" rel="Chapter" href="CamlinternalOO.html"><link title="Combinators" rel="Section" href="#combinators">
<link title="Exception handling" rel="Section" href="#exception">
<link title="Examples" rel="Section" href="#examples">
<link title="Combinators" rel="Subsection" href="#2_Combinators">
<title>OCaml library : Stdlib.Fun</title>
</head>
<body>
<h1>Module <a href="type_Stdlib.Fun.html">Stdlib.Fun</a></h1>

<pre><span id="MODULEFun"><span class="keyword">module</span> Fun</span>: <code class="type"><a href="Fun.html">Fun</a></code></pre><hr width="100%">
<h2 id="combinators">Combinators</h2>
<pre><span id="VALid"><span class="keyword">val</span> id</span> : <code class="type">'a -&gt; 'a</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">id</code> is the identity function. For any argument <code class="code">x</code>, <code class="code">id&nbsp;x</code> is <code class="code">x</code>.</p>
</div>
</div>

<pre><span id="VALconst"><span class="keyword">val</span> const</span> : <code class="type">'a -&gt; 'b -&gt; 'a</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">const&nbsp;c</code> is a function that always returns the value <code class="code">c</code>. For any
    argument <code class="code">x</code>, <code class="code">(const&nbsp;c)&nbsp;x</code> is <code class="code">c</code>.</p>
</div>
</div>

<pre><span id="VALcompose"><span class="keyword">val</span> compose</span> : <code class="type">('b -&gt; 'c) -&gt; ('a -&gt; 'b) -&gt; 'a -&gt; 'c</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">compose&nbsp;f&nbsp;g</code> is a function composition of applying <code class="code">g</code> then <code class="code">f</code>.
    For any arguments <code class="code">f</code>, <code class="code">g</code>, and <code class="code">x</code>, <code class="code">compose&nbsp;f&nbsp;g&nbsp;x</code> is <code class="code">f&nbsp;(g&nbsp;x)</code>.</p>
</div>
<ul class="info-attributes">
<li><b>Since</b> 5.2</li>
</ul>
</div>

<pre><span id="VALflip"><span class="keyword">val</span> flip</span> : <code class="type">('a -&gt; 'b -&gt; 'c) -&gt; 'b -&gt; 'a -&gt; 'c</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">flip&nbsp;f</code> reverses the argument order of the binary function
    <code class="code">f</code>. For any arguments <code class="code">x</code> and <code class="code">y</code>, <code class="code">(flip&nbsp;f)&nbsp;x&nbsp;y</code> is <code class="code">f&nbsp;y&nbsp;x</code>.</p>
</div>
</div>

<pre><span id="VALnegate"><span class="keyword">val</span> negate</span> : <code class="type">('a -&gt; bool) -&gt; 'a -&gt; bool</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">negate&nbsp;p</code> is the negation of the predicate function <code class="code">p</code>. For any
    argument <code class="code">x</code>, <code class="code">(negate&nbsp;p)&nbsp;x</code> is <code class="code">not&nbsp;(p&nbsp;x)</code>.</p>
</div>
</div>
<h2 id="exception">Exception handling</h2>
<pre><span id="VALprotect"><span class="keyword">val</span> protect</span> : <code class="type">finally:(unit -&gt; unit) -&gt; (unit -&gt; 'a) -&gt; 'a</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">protect&nbsp;~finally&nbsp;work</code> invokes <code class="code">work&nbsp;()</code> and then <code class="code">finally&nbsp;()</code>
    before <code class="code">work&nbsp;()</code> returns with its value or an exception. In the
    latter case the exception is re-raised after <code class="code">finally&nbsp;()</code>. If
    <code class="code">finally&nbsp;()</code> raises an exception, then the exception
    <a href="Fun.html#EXCEPTIONFinally_raised"><code class="code"><span class="constructor">Fun</span>.<span class="constructor">Finally_raised</span></code></a> is raised instead.</p>

<p><code class="code">protect</code> can be used to enforce local invariants whether <code class="code">work&nbsp;()</code>
    returns normally or raises an exception. However, it does not
    protect against unexpected exceptions raised inside <code class="code">finally&nbsp;()</code>
    such as <a href="Stdlib.html#EXCEPTIONOut_of_memory"><code class="code"><span class="constructor">Out_of_memory</span></code></a>, <a href="Stdlib.html#EXCEPTIONStack_overflow"><code class="code"><span class="constructor">Stack_overflow</span></code></a>, or
    asynchronous exceptions raised by signal handlers
    (e.g. <a href="Sys.html#EXCEPTIONBreak"><code class="code"><span class="constructor">Sys</span>.<span class="constructor">Break</span></code></a>).</p>

<p>Note: It is a <em>programming error</em> if other kinds of exceptions
    are raised by <code class="code">finally</code>, as any exception raised in <code class="code">work&nbsp;()</code> will
    be lost in the event of a <a href="Fun.html#EXCEPTIONFinally_raised"><code class="code"><span class="constructor">Fun</span>.<span class="constructor">Finally_raised</span></code></a> exception. Therefore,
    one should make sure to handle those inside the finally.</p>
</div>
</div>

<pre><span id="EXCEPTIONFinally_raised"><span class="keyword">exception</span> Finally_raised</span> <span class="keyword">of</span> <code class="type">exn</code></pre>
<div class="info ">
<div class="info-desc">
<p><code class="code"><span class="constructor">Finally_raised</span>&nbsp;exn</code> is raised by <code class="code">protect&nbsp;~finally&nbsp;work</code> when
    <code class="code">finally</code> raises an exception <code class="code">exn</code>. This exception denotes either
    an unexpected exception or a programming error. As a general rule,
    one should not catch a <code class="code"><span class="constructor">Finally_raised</span></code> exception except as part of
    a catch-all handler.</p>
</div>
</div>
<h2 id="examples">Examples</h2>
<h3 id="2_Combinators">Combinators</h3>
<p><a href="Fun.html#combinators">Combinators</a> provide a lightweight and sometimes more readable
way to create anonymous functions, best used as short-lived arguments rather
than standalone definitions. The examples below will demonstrate this mainly
with the <a href="List.html"><code class="code"><span class="constructor">List</span></code></a> module.</p>

<h4 id="hid"><a href="Fun.html#VALid">id</a></h4>
<p><a href="List.html#VALinit"><code class="code"><span class="constructor">List</span>.init</code></a> with the index itself</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.init 3 <span class="constructor">Fun</span>.id;;
  - : int list = [0; 1; 2]
</code></pre>
<p>Using <a href="List.html#VALfilter_map"><code class="code"><span class="constructor">List</span>.filter_map</code></a> on an <code class="code">int&nbsp;option&nbsp;list</code> to filter out
<a href="Option.html#TYPEELTt.None"><code class="code"><span class="constructor">None</span></code></a> elements</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.filter_map <span class="constructor">Fun</span>.id [<span class="constructor">None</span>; <span class="constructor">Some</span> 2; <span class="constructor">Some</span> 3; <span class="constructor">None</span>; <span class="constructor">Some</span> 5];;
  - : int list = [2; 3; 5]
</code></pre>
<p>Conditionally dispatching functions of type <code class="code">foo&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;foo</code> or taking them as
arguments is another place where <code class="code">id</code> may be useful. Consider a primitive
logging function which prints a string but gives its user the option to
preformat the string before printing, e.g. to insert a time-stamp</p>
<pre class="codepre"><code class="code">  <span class="keyword">let</span> log ?(preformat : string <span class="keywordsign">-&gt;</span> string = <span class="constructor">Fun</span>.id) message =
    print_endline (preformat message)
</code></pre><p>Whenever we may build up closures, <code class="code">id</code> is often used for the base-case as a
no-op. Consider a function which chains a list of unary functions:</p>
<pre class="codepre"><code class="code">  <span class="keyword">let</span> <span class="keyword">rec</span> chain = <span class="keyword">function</span>
    <span class="keywordsign">|</span> [] <span class="keywordsign">-&gt;</span> <span class="constructor">Fun</span>.id
    <span class="keywordsign">|</span> f :: fs <span class="keywordsign">-&gt;</span> <span class="keyword">fun</span> x <span class="keywordsign">-&gt;</span> f (chain fs x)
</code></pre>
<h4 id="hconst"><a href="Fun.html#VALconst">const</a></h4>
<p><a href="List.html#VALinit"><code class="code"><span class="constructor">List</span>.init</code></a> a list of zeros</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.init 3 (<span class="constructor">Fun</span>.const 0);;
  - : int list = [0; 0; 0]
</code></pre>
<p>An allow-all predicate that could be passed to any filtering function e.g.
<a href="List.html#VALfilter"><code class="code"><span class="constructor">List</span>.filter</code></a> to disable filtration and get back all values</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.filter (<span class="constructor">Fun</span>.const <span class="keyword">true</span>) [1; 2; 3];;
  - : int list = [1; 2; 3]
</code></pre>
<p>Note that applying <code class="code">const&nbsp;(...)</code> evaluates the expression <code class="code">(...)</code> once, and
returns a function that only has the result of this evaluation. To demonstrate
this, consider if <code class="code">(...)</code> was a call to <a href="Random.html#VALbool"><code class="code"><span class="constructor">Random</span>.bool</code></a><code class="code">()</code>:</p>

<p><code class="code"><span class="constructor">List</span>.init&nbsp;n&nbsp;(<span class="constructor">Fun</span>.const&nbsp;(<span class="constructor">Random</span>.bool()))</code> for any <code class="code">n&nbsp;&gt;&nbsp;0</code> will have <em>exactly
two</em> possible outcomes,</p>
<ul>
<li><code class="code">[<span class="keyword">true</span>;&nbsp;<span class="keyword">true</span>;&nbsp;...;&nbsp;<span class="keyword">true</span>]</code></li>
<li><code class="code">[<span class="keyword">false</span>;&nbsp;<span class="keyword">false</span>;&nbsp;...;&nbsp;<span class="keyword">false</span>]</code></li>
</ul>
<p>whereas <code class="code"><span class="constructor">List</span>.init&nbsp;n&nbsp;(<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Random</span>.bool())</code> will have 2<sup class="superscript">n</sup> possible
outcomes, because the randomness effect is performed with every element.</p>

<p>For more real-world uses, consider <a href="String.html#VALspellcheck"><code class="code"><span class="constructor">String</span>.spellcheck</code></a> with a constant max
distance of 2, instead of the default variable max distance</p>
<pre class="codepre"><code class="code">  <span class="keyword">let</span> spellcheck known_words word =
    <span class="keyword">let</span> dict_iter yield = <span class="constructor">List</span>.iter yield known_words <span class="keyword">in</span>
    <span class="constructor">String</span>.spellcheck ~max_dist:(<span class="constructor">Fun</span>.const 2) dict_iter word
</code></pre>
<h4 id="hflip"><a href="Fun.html#VALflip">flip</a></h4>
<p>Using <code class="code">flip</code> to reverse the comparator passed to <a href="List.html#VALsort"><code class="code"><span class="constructor">List</span>.sort</code></a>, which sorts
in the opposite order</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.sort (<span class="constructor">Fun</span>.flip <span class="constructor">Int</span>.compare) [5; 3; 9; 0; 1; 6; 8];;
  - : int list = [9; 8; 6; 5; 3; 1; 0]
</code></pre>
<p>Reversing a list by accumulating a new list using <a href="List.html#VALfold_left"><code class="code"><span class="constructor">List</span>.fold_left</code></a>, which
expects the accumulator to be the first argument of the function passed to it.
We pass <a href="List.html#VALcons"><code class="code"><span class="constructor">List</span>.cons</code></a> which has the list as the second argument, so <code class="code">flip</code>
is useful here</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.fold_left (<span class="constructor">Fun</span>.flip <span class="constructor">List</span>.cons) [] [1; 2; 3];;
  - : int list = [3; 2; 1]
</code></pre>
<p>Interestingly, <code class="code">flip</code> can work with functions that aren't binary, by flipping
the first two arguments and leaving the rest in order. This is because a
function that takes <code class="code">n+2</code> arguments is, conceptually, a binary function which
returns a function that takes <code class="code">n</code> arguments.
Given a function <code class="code">f&nbsp;:&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;b&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;c&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;d</code>:</p>
<ul>
<li><code class="code">flip&nbsp;f</code> will have type <code class="code">b&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;c&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;d</code></li>
<li><code class="code"><span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;flip&nbsp;(f&nbsp;x)</code> will have type <code class="code">a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;c&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;b&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;d</code></li>
</ul>
<p>Using <code class="code">flip</code> with non-binary functions like this is discouraged, for its
negative impact on readability and reasoning.</p>

<h4 id="hnegate"><a href="Fun.html#VALnegate">negate</a></h4>
<p>Mainly used for reversing a predicate in a function which expects one, like
<a href="List.html#VALfind_all"><code class="code"><span class="constructor">List</span>.find_all</code></a> and similar functions</p>

<p>Finding all lists which are <em>not</em> empty using <a href="List.html#VALis_empty"><code class="code"><span class="constructor">List</span>.is_empty</code></a></p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.find_all (<span class="constructor">Fun</span>.negate <span class="constructor">List</span>.is_empty) [[0]; [1; 2; 3]; []; [4; 5]];;
  - : int list list = [[0]; [1; 2; 3]; [4; 5]]
</code></pre>
<p>From a given list of paths, finding all paths which are <em>not</em> occupied using
<a href="Sys.html#VALfile_exists"><code class="code"><span class="constructor">Sys</span>.file_exists</code></a></p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.find_all (<span class="constructor">Fun</span>.negate <span class="constructor">Sys</span>.file_exists);;
  - : string list <span class="keywordsign">-&gt;</span> string list = &lt;<span class="keyword">fun</span>&gt;
</code></pre>
<h4 id="hcompose"><a href="Fun.html#VALcompose">compose</a></h4>
<p><a href="List.html#VALmap"><code class="code"><span class="constructor">List</span>.map</code></a> on pair elements with a function on the second element</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">List</span>.map (<span class="constructor">Fun</span>.compose <span class="constructor">String</span>.length snd) [1, <span class="string">"one"</span>; 2, <span class="string">"two"</span>; 3, <span class="string">"three"</span>];;
  - : int list = [3; 3; 5]
</code></pre>
<p>A potential implementation of <a href="Fun.html#VALnegate"><code class="code"><span class="constructor">Fun</span>.negate</code></a></p>
<pre class="codepre"><code class="code">  <span class="keyword">let</span> negate f = <span class="constructor">Fun</span>.compose not f
</code></pre>
<p>From the <a href="Fun.html#hid"><code class="code">chain</code> example</a>, <code class="code">compose</code> could have been used in the
recursive branch</p>
<pre class="codepre"><code class="code">  <span class="keyword">let</span> <span class="keyword">rec</span> chain = <span class="keyword">function</span>
    <span class="keywordsign">|</span> [] <span class="keywordsign">-&gt;</span> <span class="constructor">Fun</span>.id
    <span class="keywordsign">|</span> f :: fs <span class="keywordsign">-&gt;</span> <span class="constructor">Fun</span>.compose f (chain fs)
</code></pre><p>Or even more concisely</p>
<pre class="codepre"><code class="code">  <span class="keyword">let</span> chain fs = <span class="constructor">List</span>.fold_right <span class="constructor">Fun</span>.compose fs <span class="constructor">Fun</span>.id
</code></pre>
<p>From the <a href="Fun.html#hflip"><code class="code">spellcheck</code> example</a>, <code class="code">compose</code> and <code class="code">flip</code> could be used to
condense the function definition so it becomes</p>
<pre class="codepre"><code class="code">  <span class="keywordsign">#</span> <span class="constructor">Fun</span>.compose
      (<span class="constructor">String</span>.spellcheck ~max_dist:(<span class="constructor">Fun</span>.const 2))
      (<span class="constructor">Fun</span>.flip <span class="constructor">List</span>.iter)
    ;;
  - : string list <span class="keywordsign">-&gt;</span> string <span class="keywordsign">-&gt;</span> string list = &lt;<span class="keyword">fun</span>&gt;
</code></pre><p>As can be seen here, this heavily impacts readability and the ability to reason
about the function. Both <code class="code"><span class="constructor">String</span>.spellcheck</code> and <code class="code"><span class="constructor">Fun</span>.flip</code> are not unary, so
there is a non-trivial interaction with partial-application in this definition.</p>

<p>Heavy use of these combinators in OCaml is generally discouraged, not only
because they can quickly impact readability and reasoning, but also because the
produced functions are often in value form, thus subject to the Value
Restriction (see the manual section 6.1.2).</p>
</body></html>
