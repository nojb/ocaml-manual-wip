<!DOCTYPE html>
<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="hevea 2.36">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<link rel="stylesheet" type="text/css" href="manual.css">
<title>12.25 Type-directed disambiguation of array literals</title>
</head>
<body>
<a href="effects.html"><img src="previous_motif.svg" alt="Previous"></a>
<a href="extn.html"><img src="contents_motif.svg" alt="Up"></a>
<a href="labeledtuples.html"><img src="next_motif.svg" alt="Next"></a>
<hr>
<h2 class="section" id="s:array-literals"><a class="section-anchor" href="#s:array-literals" aria-hidden="true">﻿</a>12.25 Type-directed disambiguation of array literals</h2>
<p>(Introduced in OCaml 5.4)</p><p>Since OCaml 5.4, array literal syntax <span class="syntax-token">[|</span> <span class="nonterminal">e1</span> <span class="syntax-token">;</span> <span class="nonterminal">e2</span> <span class="syntax-token">;</span> ... <span class="syntax-token">;</span> <span class="nonterminal">eN</span> <span class="syntax-token">|]</span> can
be used to denote values of type <span class="machine"><span class="font-tt">floatarray</span></span> as well as <span class="machine"><span class="font-tt">'a array</span></span>, both in
expression and pattern positions. This syntax is also used to display
<span class="machine"><span class="font-tt">floatarray</span></span> values in the toplevel.</p><p>The compiler matches the expected type of the expression or pattern with the
type of the literal, in a manner analogous to the disambiguation of constructors
and record fields (see <a href="coreexamples.html#ss%3Arecord-and-variant-disambiguation">1.4.1</a>).</p><p>In the absence of an expected type, array literals are assumed to be of type <span class="machine"><span class="font-tt">'a array</span></span>.</p><p>In the following examples, the array literals are assigned type <span class="machine"><span class="font-tt">floatarray</span></span>:</p><div class="caml-example verbatim">

<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> _ : floatarray = [|42.|];;</div>



<div class="pre caml-output ok">- : floatarray = [|42.|]</div></div>
<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> _ = ([|42.|] : floatarray);;</div>



<div class="pre caml-output ok">- : floatarray = [|42.|]</div></div>
<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> _ = Float.Array.length [|42.|];;</div>



<div class="pre caml-output ok">- : int = 1</div></div>

</div><p>The same disambiguation mechanism is used for array literals appearing in
patterns:</p><div class="caml-example verbatim">

<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> f : floatarray -&gt; _ = <span class="ocamlkeyword">function</span>
  | [| 42. |] -&gt; <span class="ocamlstring">"It's a floatarray containing one element"</span>
  | _ -&gt; <span class="ocamlstring">"Also a floatarray"</span>
;;</div>



<div class="pre caml-output ok"><span class="ocamlkeyword">val</span> f : floatarray -&gt; string = &lt;<span class="ocamlkeyword">fun</span>&gt;</div></div>

</div><p>In the example below, <span class="machine"><span class="font-tt">x</span></span> is assigned type <span class="machine"><span class="font-tt">float array</span></span>:</p><div class="caml-example verbatim">

<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> x = [|42.|];;</div>



<div class="pre caml-output ok"><span class="ocamlkeyword">val</span> x : float array = [|42.|]</div></div>

</div><p>However, the following does not work:</p><div class="caml-example verbatim">

<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> f a =
  <span class="ocamlkeyword">match</span> a <span class="ocamlkeyword">with</span>
  | [| _ |] -&gt; Float.Array.length <span class="ocamlhighlight">a</span>
  | _ -&gt; 42
;;</div>



<div class="pre caml-output error"><span class="ocamlerror">Error</span>: The value a has type 'a array but an expression was expected of type
         Float.Array.t = floatarray</div></div>
<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> f b (a : floatarray) = <span class="ocamlkeyword">if</span> b <span class="ocamlkeyword">then</span> [|42.|] <span class="ocamlkeyword">else</span> <span class="ocamlhighlight">a</span>
;;</div>



<div class="pre caml-output error"><span class="ocamlerror">Error</span>: The value a has type floatarray but an expression was expected of type
         float array</div></div>

</div><p>Here the information learned from the use of <span class="machine"><span class="font-tt">a</span></span> as a <span class="machine"><span class="font-tt">floatarray</span></span> cannot be
propagated back to the array literal. In general, expected type information
cannot be propagated “backwards”.</p><p>In the following example, type disambiguation works because the type information
learned in the <span class="machine"><span class="font-tt">then</span></span> branch of the conditional is propagated to the <span class="machine"><span class="font-tt">else</span></span>
branch, which occurs “later”.</p><div class="caml-example verbatim">

<div class="ocaml">



<div class="pre caml-input"><span class="ocamlkeyword">let</span> f b (a : floatarray) = <span class="ocamlkeyword">if</span> b <span class="ocamlkeyword">then</span> a <span class="ocamlkeyword">else</span> [|42.|];;</div>



<div class="pre caml-output ok"><span class="ocamlkeyword">val</span> f : bool -&gt; floatarray -&gt; floatarray = &lt;<span class="ocamlkeyword">fun</span>&gt;</div></div>

</div><p>Such cases trigger warning 18 <span class="machine"><span class="font-tt">not-principal</span></span>, if enabled.

</p>
<hr>
<a href="effects.html"><img src="previous_motif.svg" alt="Previous"></a>
<a href="extn.html"><img src="contents_motif.svg" alt="Up"></a>
<a href="labeledtuples.html"><img src="next_motif.svg" alt="Next"></a>
</body>
</html>
